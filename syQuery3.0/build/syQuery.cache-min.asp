<%$.add("cache",function(){var cache=function(conn){this.flag="syQuery";this.root="syQuery3.0/docs/cache";this.conn=conn},DATA=$.use("data"),STREAM=$.use("stream"),FSO=$.use("fso");$.augment(cache,{set:function(key,value){if(value==undefined){Application.Lock();for(var i in key){Application.StaticObjects(this.flag).Item(i)=key[i]}Application.UnLock()}else{Application.Lock();Application.StaticObjects(this.flag).Item(key)=value;Application.UnLock();return value}},get:function(key){return Application.StaticObjects(this.flag).Item(key)||undefined},load:function(key,moden,sql){var AppFile=$.root+this.root+"/"+this.flag+"."+key+".cache",AppTMP;moden=!moden?0:moden;if((moden===0||(moden===1))&&this.get(key)!=undefined){return this.get(key)}else{if((moden===0||(moden===2))&&FSO(AppFile).exsit()){return eval((new STREAM()).load(AppFile,2))}else{AppTMP=getDataByBase(sql,this.conn);if(moden===0||(moden===1)){this.set(key,AppTMP)}if(moden===0||(moden===2)){this.write(key,moden,AppTMP)}return AppTMP}}},write:function(key,moden,sql){var AppFile=$.root+this.root+"/"+this.flag+"."+key+".cache",RsData=$.isString(sql)?getDataByBase(sql,this.conn):sql,_RsData;moden=!moden?0:moden;if(moden===0||moden===1){this.set(key,RsData)}if(moden===0||moden===2){_RsData="["+RsData.map(function(i,m){return"["+m.map(function(j,n){return(n==null||n==undefined)?"''":"'"+encodeURIComponent(n)+"'"}).join(",")+"]"}).join(",")+"]";FSO(AppFile.split("/").slice(0,-1).join("/")).create();(new STREAM()).save(_RsData,AppFile,2);return RsData}}});function getDataByBase(sql,conn){return DATA.select(sql,function(){return this.getRows()},conn)}return cache},{reqiure:["fso","stream","data"]});%>